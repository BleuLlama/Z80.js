function Z80(a){if(!a||"function"!==typeof a.mem_read||"function"!==typeof a.mem_write||"function"!==typeof a.io_read||"function"!==typeof a.io_write)throw"Z80: Core object is missing required functions.";if(this===window)throw"Z80: This function is a constructor; call it using operator new.";this.core=a;this.r=this.i=this.iy=this.ix=this.l_prime=this.h_prime=this.e_prime=this.d_prime=this.c_prime=this.b_prime=this.a_prime=this.l=this.h=this.e=this.d=this.c=this.b=this.a=0;this.sp=57328;this.pc=0;
this.flags={S:0,Z:0,Y:0,H:0,X:0,P:0,N:0,C:0};this.flags_prime={S:0,Z:0,Y:0,H:0,X:0,P:0,N:0,C:0};this.iff2=this.iff1=this.imode=0;this.do_delayed_ei=this.do_delayed_di=this.halted=!1;this.cycle_counter=0;return{reset:this.reset.bind(this),run_instruction:this.run_instruction.bind(this),interrupt:this.interrupt.bind(this)}}
Z80.prototype.reset=function(){this.sp=57328;this.r=this.a=this.pc=0;this.set_flags_register(0);this.iff2=this.iff1=this.imode=0;this.do_delayed_ei=this.do_delayed_di=this.halted=!1;this.cycle_counter=0};
Z80.prototype.run_instruction=function(){if(this.halted)return 1;var a=!1,b=!1;this.do_delayed_di?(this.do_delayed_di=!1,a=!0):this.do_delayed_ei&&(this.do_delayed_ei=!1,b=!0);this.r=this.r&128|(this.r&127)+1&127;var c=this.core.mem_read(this.pc);this.decode_instruction(c);this.pc=this.pc+1&65535;a?this.iff2=this.iff1=0:b&&(this.iff2=this.iff1=1);a=this.cycle_counter;this.cycle_counter=0;return a};
Z80.prototype.interrupt=function(a,b){if(a)this.r=this.r&128|(this.r&127)+1&127,this.halted=!1,this.iff2=this.iff1,this.iff1=0,this.push_word(this.pc),this.pc=102,this.cycle_counter+=11;else if(this.iff1)if(this.r=this.r&128|(this.r&127)+1&127,this.halted=!1,this.iff2=this.iff1=0,0===this.imode)this.decode_instruction(b),this.cycle_counter+=2;else if(1===this.imode)this.push_word(this.pc),this.pc=56,this.cycle_counter+=13;else if(2===this.imode){this.push_word(this.pc);var c=this.i<<8|b;this.pc=this.core.read_mem_byte(c)|
this.core.read_mem_byte(c+1&65535)<<8;this.cycle_counter+=19}};
Z80.prototype.decode_instruction=function(a){var b=function(a){return 0===(a&7)?this.b:1===(a&7)?this.c:2===(a&7)?this.d:3===(a&7)?this.e:4===(a&7)?this.h:5===(a&7)?this.l:6===(a&7)?this.core.mem_read(this.l|this.h<<8):this.a};118===a?(this.halted=!0,this.iff2=this.iff1=1):64<=a&&128>a?(b=b.call(this,a),0===(a&56)>>>3?this.b=b:1===(a&56)>>>3?this.c=b:2===(a&56)>>>3?this.d=b:3===(a&56)>>>3?this.e=b:4===(a&56)>>>3?this.h=b:5===(a&56)>>>3?this.l=b:6===(a&56)>>>3?this.core.mem_write(this.l|this.h<<8,
b):7===(a&56)>>>3&&(this.a=b)):128<=a&&192>a?(b=b.call(this,a),[this.do_add,this.do_adc,this.do_sub,this.do_sbc,this.do_and,this.do_xor,this.do_or,this.do_cp][(a&56)>>>3].call(this,b)):this.instructions[a].bind(this)();this.cycle_counter+=this.cycle_counts[a]};Z80.prototype.get_signed_offset_byte=function(a){a&=255;a&128&&(a=-((255&~a)+1));return a};
Z80.prototype.get_flags_register=function(){return this.flags.S<<7|this.flags.Z<<6|this.flags.Y<<5|this.flags.H<<4|this.flags.X<<3|this.flags.P<<2|this.flags.N<<1|this.flags.C};Z80.prototype.get_flags_prime=function(){return this.flags_prime.S<<7|this.flags_prime.Z<<6|this.flags_prime.Y<<5|this.flags_prime.H<<4|this.flags_prime.X<<3|this.flags_prime.P<<2|this.flags_prime.N<<1|this.flags_prime.C};
Z80.prototype.set_flags_register=function(a){this.flags.S=(a&128)>>>7;this.flags.Z=(a&64)>>>6;this.flags.Y=(a&32)>>>5;this.flags.H=(a&16)>>>4;this.flags.X=(a&8)>>>3;this.flags.P=(a&4)>>>2;this.flags.N=(a&2)>>>1;this.flags.C=a&1};Z80.prototype.set_flags_prime=function(a){this.flags_prime.S=(a&128)>>>7;this.flags_prime.Z=(a&64)>>>6;this.flags_prime.Y=(a&32)>>>5;this.flags_prime.H=(a&16)>>>4;this.flags_prime.X=(a&8)>>>3;this.flags_prime.P=(a&4)>>>2;this.flags_prime.N=(a&2)>>>1;this.flags_prime.C=a&1};
Z80.prototype.update_xy_flags=function(a){this.flags.Y=(a&32)>>>5;this.flags.X=(a&8)>>>3};
Z80.prototype.get_parity=function(a){return[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1][a]};Z80.prototype.push_word=function(a){this.sp=this.sp-1&65535;this.core.mem_write(this.sp,(a&65280)>>>8);this.sp=this.sp-1&65535;this.core.mem_write(this.sp,a&255)};Z80.prototype.pop_word=function(){var a=this.core.mem_read(this.sp)&255;this.sp=this.sp+1&65535;a|=this.core.mem_read(this.sp)<<8;this.sp=this.sp+1&65535;return a};
Z80.prototype.do_conditional_absolute_jump=function(a){a?(this.pc=this.core.mem_read(this.pc+1&65535)|this.core.mem_read(this.pc+2&65535)<<8,this.pc=this.pc-1&65535):this.pc=this.pc+2&65535};Z80.prototype.do_conditional_relative_jump=function(a){a?(this.cycle_counter+=5,a=this.get_signed_offset_byte(this.core.mem_read(this.pc+1&65535)),this.pc=this.pc+a+1&65535):this.pc=this.pc+1&65535};
Z80.prototype.do_conditional_call=function(a){a?(this.cycle_counter+=7,this.push_word(this.pc+3&65535),this.pc=this.core.mem_read(this.pc+1&65535)|this.core.mem_read(this.pc+2&65535)<<8,this.pc=this.pc-1&65535):this.pc=this.pc+2&65535};Z80.prototype.do_conditional_return=function(a){a&&(this.cycle_counter+=6,this.pc=this.pop_word()-1&65535)};Z80.prototype.do_reset=function(a){this.push_word(this.pc+1&65535);this.pc=a-1&65535};
Z80.prototype.do_add=function(a){var b=this.a+a;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=(a&15)+(this.a&15)&16?1:0;this.flags.P=(this.a&128)===(a&128)&&(this.a&128)!==(b&128)?1:0;this.flags.N=0;this.flags.C=b&256?1:0;this.a=b&255;this.update_xy_flags(this.a)};
Z80.prototype.do_adc=function(a){var b=this.a+a+this.flags.C;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=(a&15)+(this.a&15)+this.flags.C&16?1:0;this.flags.P=(this.a&128)===(a&128)&&(this.a&128)!==(b&128)?1:0;this.flags.N=0;this.flags.C=b&256?1:0;this.a=b&255;this.update_xy_flags(this.a)};
Z80.prototype.do_sub=function(a){var b=this.a-a;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=(this.a&15)-(a&15)&16?1:0;this.flags.P=(this.a&128)!==(a&128)&&(this.a&128)!==(b&128)?1:0;this.flags.N=1;this.flags.C=b&256?1:0;this.a=b&255;this.update_xy_flags(this.a)};
Z80.prototype.do_sbc=function(a){var b=this.a-a-this.flags.C;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=(this.a&15)-(a&15)-this.flags.C&16?1:0;this.flags.P=(this.a&128)!==(a&128)&&(this.a&128)!==(b&128)?1:0;this.flags.N=1;this.flags.C=b&256?1:0;this.a=b&255;this.update_xy_flags(this.a)};Z80.prototype.do_cp=function(a){var b=this.a;this.do_sub(a);this.a=b;this.update_xy_flags(a)};
Z80.prototype.do_and=function(a){this.a&=a&255;this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=1;this.flags.P=this.get_parity(this.a);this.flags.N=0;this.flags.C=0;this.update_xy_flags(this.a)};Z80.prototype.do_or=function(a){this.a=(a|this.a)&255;this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=0;this.flags.P=this.get_parity(this.a);this.flags.N=0;this.flags.C=0;this.update_xy_flags(this.a)};
Z80.prototype.do_xor=function(a){this.a=(a^this.a)&255;this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=0;this.flags.P=this.get_parity(this.a);this.flags.N=0;this.flags.C=0;this.update_xy_flags(this.a)};Z80.prototype.do_inc=function(a){var b=a+1;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=15===(a&15)?1:0;this.flags.P=127===a?1:0;this.flags.N=0;b&=255;this.update_xy_flags(b);return b};
Z80.prototype.do_dec=function(a){var b=a-1;this.flags.S=b&128?1:0;this.flags.Z=b&255?0:1;this.flags.H=0===(a&15)?1:0;this.flags.P=128===a?1:0;this.flags.N=1;b&=255;this.update_xy_flags(b);return b};Z80.prototype.do_hl_add=function(a){var b=this.l|this.h<<8,c=b+a;this.flags.N=0;this.flags.C=c&65536?1:0;this.flags.H=(b&4095)+(a&4095)&4096?1:0;this.l=c&255;this.h=(c&65280)>>>8;this.update_xy_flags(this.h)};
Z80.prototype.do_hl_adc=function(a){a+=this.flags.C;var b=this.l|this.h<<8,c=b+a;this.flags.S=c&32768?1:0;this.flags.Z=c&65535?0:1;this.flags.H=(b&4095)+(a&4095)&4096?1:0;this.flags.P=(b&32768)===(a&32768)&&(c&32768)!==(b&32768)?1:0;this.flags.N=0;this.flags.C=c&65536?1:0;this.l=c&255;this.h=c>>>8&255;this.update_xy_flags(this.h)};
Z80.prototype.do_hl_sbc=function(a){a+=this.flags.C;var b=this.l|this.h<<8,c=b-a;this.flags.S=c&32768?1:0;this.flags.Z=c&65535?0:1;this.flags.H=(b&4095)-(a&4095)&4096?1:0;this.flags.P=(b&32768)!==(a&32768)&&(c&32768)!==(b&32768)?1:0;this.flags.N=1;this.flags.C=c&65536?1:0;this.l=c&255;this.h=c>>>8&255;this.update_xy_flags(this.h)};
Z80.prototype.do_in=function(a){a=this.core.io_read(a);this.flags.S=a&128?1:0;this.flags.Z=a?0:1;this.flags.H=0;this.flags.P=this.get_parity(a)?1:0;this.flags.N=0;this.update_xy_flags(a);return a};Z80.prototype.do_neg=function(){128!==this.a&&(this.a=this.get_signed_offset_byte(this.a),this.a=-this.a&255);this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=0<(-this.a&15)?1:0;this.flags.P=128===this.a?1:0;this.flags.N=1;this.flags.C=this.a?1:0;this.update_xy_flags(this.a)};
Z80.prototype.do_ldi=function(){var a=this.core.mem_read(this.l|this.h<<8);this.core.mem_write(this.e|this.d<<8,a);var b=(this.e|this.d<<8)+1;this.e=b&255;this.d=(b&65280)>>>8;b=(this.l|this.h<<8)+1;this.l=b&255;this.h=(b&65280)>>>8;b=(this.c|this.b<<8)-1;this.c=b&255;this.b=(b&65280)>>>8;this.flags.H=0;this.flags.P=this.c||this.b?1:0;this.flags.N=0;this.flags.Y=(this.a+a&2)>>>1;this.flags.X=(this.a+a&8)>>>3};
Z80.prototype.do_cpi=function(){var a=this.flags.C,b=this.core.mem_read(this.l|this.h<<8);this.do_cp(b);this.flags.C=a;this.flags.Y=(this.a-b-this.flags.H&2)>>>1;this.flags.X=(this.a-b-this.flags.H&8)>>>3;a=(this.l|this.h<<8)+1;this.l=a&255;this.h=(a&65280)>>>8;a=(this.c|this.b<<8)-1;this.c=a&255;this.b=(a&65280)>>>8;this.flags.P=a?1:0};
Z80.prototype.do_ini=function(){this.b=this.do_dec(this.b);this.core.mem_write(this.l|this.h<<8,this.core.io_read(this.b<<8|this.c));var a=(this.l|this.h<<8)+1;this.l=a&255;this.h=(a&65280)>>>8;this.flags.N=1};Z80.prototype.do_outi=function(){this.core.io_write(this.b<<8|this.c,this.core.mem_read(this.l|this.h<<8));var a=(this.l|this.h<<8)+1;this.l=a&255;this.h=(a&65280)>>>8;this.b=this.do_dec(this.b);this.flags.N=1};
Z80.prototype.do_ldd=function(){this.flags.N=0;this.flags.H=0;var a=this.core.mem_read(this.l|this.h<<8);this.core.mem_write(this.e|this.d<<8,a);var b=(this.e|this.d<<8)-1;this.e=b&255;this.d=(b&65280)>>>8;b=(this.l|this.h<<8)-1;this.l=b&255;this.h=(b&65280)>>>8;b=(this.c|this.b<<8)-1;this.c=b&255;this.b=(b&65280)>>>8;this.flags.P=this.c||this.b?1:0;this.flags.Y=(this.a+a&2)>>>1;this.flags.X=(this.a+a&8)>>>3};
Z80.prototype.do_cpd=function(){var a=this.flags.C,b=this.core.mem_read(this.l|this.h<<8);this.do_cp(b);this.flags.C=a;this.flags.Y=(this.a-b-this.flags.H&2)>>>1;this.flags.X=(this.a-b-this.flags.H&8)>>>3;a=(this.l|this.h<<8)-1;this.l=a&255;this.h=(a&65280)>>>8;a=(this.c|this.b<<8)-1;this.c=a&255;this.b=(a&65280)>>>8;this.flags.P=a?1:0};
Z80.prototype.do_ind=function(){this.b=this.do_dec(this.b);this.core.mem_write(this.l|this.h<<8,this.core.io_read(this.b<<8|this.c));var a=(this.l|this.h<<8)-1;this.l=a&255;this.h=(a&65280)>>>8;this.flags.N=1};Z80.prototype.do_outd=function(){this.core.io_write(this.b<<8|this.c,this.core.mem_read(this.l|this.h<<8));var a=(this.l|this.h<<8)-1;this.l=a&255;this.h=(a&65280)>>>8;this.b=this.do_dec(this.b);this.flags.N=1};
Z80.prototype.do_rlc=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=(a&128)>>>7;a=(a<<1|this.flags.C)&255;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};Z80.prototype.do_rrc=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=a&1;a=a>>>1&127|this.flags.C<<7;this.flags.Z=a&255?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a&255};
Z80.prototype.do_rl=function(a){this.flags.N=0;this.flags.H=0;var b=this.flags.C;this.flags.C=(a&128)>>>7;a=(a<<1|b)&255;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};Z80.prototype.do_rr=function(a){this.flags.N=0;this.flags.H=0;var b=this.flags.C;this.flags.C=a&1;a=a>>>1&127|b<<7;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};
Z80.prototype.do_sla=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=(a&128)>>>7;a=a<<1&255;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};Z80.prototype.do_sra=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=a&1;a=a>>>1&127|a&128;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};
Z80.prototype.do_sll=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=(a&128)>>>7;a=a<<1&255|1;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=a&128?1:0;this.update_xy_flags(a);return a};Z80.prototype.do_srl=function(a){this.flags.N=0;this.flags.H=0;this.flags.C=a&1;a=a>>>1&127;this.flags.Z=a?0:1;this.flags.P=this.get_parity(a);this.flags.S=0;this.update_xy_flags(a);return a};
Z80.prototype.do_ix_add=function(a){this.flags.N=0;var b=this.ix+a;this.flags.C=b&65536?1:0;this.flags.H=(this.ix&4095)+(a&4095)&4096?1:0;this.update_xy_flags((b&65280)>>>8);this.ix=b};Z80.prototype.instructions=[];Z80.prototype.instructions[0]=function(){};Z80.prototype.instructions[1]=function(){this.pc=this.pc+1&65535;this.c=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;this.b=this.core.mem_read(this.pc)};Z80.prototype.instructions[2]=function(){this.core.mem_write(this.c|this.b<<8,this.a)};
Z80.prototype.instructions[3]=function(){var a=this.c|this.b<<8,a=a+1;this.c=a&255;this.b=(a&65280)>>>8};Z80.prototype.instructions[4]=function(){this.b=this.do_inc(this.b)};Z80.prototype.instructions[5]=function(){this.b=this.do_dec(this.b)};Z80.prototype.instructions[6]=function(){this.pc=this.pc+1&65535;this.b=this.core.mem_read(this.pc)};
Z80.prototype.instructions[7]=function(){var a=this.flags.S,b=this.flags.Z,c=this.flags.P;this.a=this.do_rlc(this.a);this.flags.S=a;this.flags.Z=b;this.flags.P=c};Z80.prototype.instructions[8]=function(){var a=this.a;this.a=this.a_prime;this.a_prime=a;a=this.get_flags_register();this.set_flags_register(this.get_flags_prime());this.set_flags_prime(a)};Z80.prototype.instructions[9]=function(){this.do_hl_add(this.c|this.b<<8)};
Z80.prototype.instructions[10]=function(){this.a=this.core.mem_read(this.c|this.b<<8)};Z80.prototype.instructions[11]=function(){var a=this.c|this.b<<8,a=a-1;this.c=a&255;this.b=(a&65280)>>>8};Z80.prototype.instructions[12]=function(){this.c=this.do_inc(this.c)};Z80.prototype.instructions[13]=function(){this.c=this.do_dec(this.c)};Z80.prototype.instructions[14]=function(){this.pc=this.pc+1&65535;this.c=this.core.mem_read(this.pc)};
Z80.prototype.instructions[15]=function(){var a=this.flags.S,b=this.flags.Z,c=this.flags.P;this.a=this.do_rrc(this.a);this.flags.S=a;this.flags.Z=b;this.flags.P=c};Z80.prototype.instructions[16]=function(){this.b=this.b-1&255;this.do_conditional_relative_jump(0!==this.b)};Z80.prototype.instructions[17]=function(){this.pc=this.pc+1&65535;this.e=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;this.d=this.core.mem_read(this.pc)};
Z80.prototype.instructions[18]=function(){this.core.mem_write(this.e|this.d<<8,this.a)};Z80.prototype.instructions[19]=function(){var a=this.e|this.d<<8,a=a+1;this.e=a&255;this.d=(a&65280)>>>8};Z80.prototype.instructions[20]=function(){this.d=this.do_inc(this.d)};Z80.prototype.instructions[21]=function(){this.d=this.do_dec(this.d)};Z80.prototype.instructions[22]=function(){this.pc=this.pc+1&65535;this.d=this.core.mem_read(this.pc)};
Z80.prototype.instructions[23]=function(){var a=this.flags.S,b=this.flags.Z,c=this.flags.P;this.a=this.do_rl(this.a);this.flags.S=a;this.flags.Z=b;this.flags.P=c};Z80.prototype.instructions[24]=function(){var a=this.get_signed_offset_byte(this.core.mem_read(this.pc+1&65535));this.pc=this.pc+a+1&65535};Z80.prototype.instructions[25]=function(){this.do_hl_add(this.e|this.d<<8)};Z80.prototype.instructions[26]=function(){this.a=this.core.mem_read(this.e|this.d<<8)};
Z80.prototype.instructions[27]=function(){var a=this.e|this.d<<8,a=a-1;this.e=a&255;this.d=(a&65280)>>>8};Z80.prototype.instructions[28]=function(){this.e=this.do_inc(this.e)};Z80.prototype.instructions[29]=function(){this.e=this.do_dec(this.e)};Z80.prototype.instructions[30]=function(){this.pc=this.pc+1&65535;this.e=this.core.mem_read(this.pc)};
Z80.prototype.instructions[31]=function(){var a=this.flags.S,b=this.flags.Z,c=this.flags.P;this.a=this.do_rr(this.a);this.flags.S=a;this.flags.Z=b;this.flags.P=c};Z80.prototype.instructions[32]=function(){this.do_conditional_relative_jump(!this.flags.Z)};Z80.prototype.instructions[33]=function(){this.pc=this.pc+1&65535;this.l=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;this.h=this.core.mem_read(this.pc)};
Z80.prototype.instructions[34]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.l);this.core.mem_write(a+1&65535,this.h)};Z80.prototype.instructions[35]=function(){var a=this.l|this.h<<8,a=a+1;this.l=a&255;this.h=(a&65280)>>>8};Z80.prototype.instructions[36]=function(){this.h=this.do_inc(this.h)};Z80.prototype.instructions[37]=function(){this.h=this.do_dec(this.h)};
Z80.prototype.instructions[38]=function(){this.pc=this.pc+1&65535;this.h=this.core.mem_read(this.pc)};Z80.prototype.instructions[39]=function(){var a=this.a;if(this.flags.N){if(this.flags.H||9<(this.a&15))a-=6;if(this.flags.C||153<this.a)a-=96}else{if(this.flags.H||9<(this.a&15))a+=6;if(this.flags.C||153<this.a)a+=96}this.flags.S=a&128?1:0;this.flags.Z=a&255?0:1;this.flags.H=this.a&16^a&16?1:0;this.flags.P=this.get_parity(a&255);this.flags.C=this.flags.C||153<this.a?1:0;this.a=a&255;this.update_xy_flags(this.a)};
Z80.prototype.instructions[40]=function(){this.do_conditional_relative_jump(!!this.flags.Z)};Z80.prototype.instructions[41]=function(){this.do_hl_add(this.l|this.h<<8)};Z80.prototype.instructions[42]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.l=this.core.mem_read(a);this.h=this.core.mem_read(a+1&65535)};Z80.prototype.instructions[43]=function(){var a=this.l|this.h<<8,a=a-1;this.l=a&255;this.h=(a&65280)>>>8};
Z80.prototype.instructions[44]=function(){this.l=this.do_inc(this.l)};Z80.prototype.instructions[45]=function(){this.l=this.do_dec(this.l)};Z80.prototype.instructions[46]=function(){this.pc=this.pc+1&65535;this.l=this.core.mem_read(this.pc)};Z80.prototype.instructions[47]=function(){this.a=~this.a&255;this.flags.N=1;this.flags.H=1;this.update_xy_flags(this.a)};Z80.prototype.instructions[48]=function(){this.do_conditional_relative_jump(!this.flags.C)};
Z80.prototype.instructions[49]=function(){this.sp=this.core.mem_read(this.pc+1&65535)|this.core.mem_read(this.pc+2&65535)<<8;this.pc=this.pc+2&65535};Z80.prototype.instructions[50]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.a)};Z80.prototype.instructions[51]=function(){this.sp=this.sp+1&65535};Z80.prototype.instructions[52]=function(){var a=this.l|this.h<<8;this.core.mem_write(a,this.do_inc(this.core.mem_read(a)))};
Z80.prototype.instructions[53]=function(){var a=this.l|this.h<<8;this.core.mem_write(a,this.do_dec(this.core.mem_read(a)))};Z80.prototype.instructions[54]=function(){this.pc=this.pc+1&65535;this.core.mem_write(this.l|this.h<<8,this.core.mem_read(this.pc))};Z80.prototype.instructions[55]=function(){this.flags.N=0;this.flags.H=0;this.flags.C=1;this.update_xy_flags(this.a)};Z80.prototype.instructions[56]=function(){this.do_conditional_relative_jump(!!this.flags.C)};Z80.prototype.instructions[57]=function(){this.do_hl_add(this.sp)};
Z80.prototype.instructions[58]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.a=this.core.mem_read(a)};Z80.prototype.instructions[59]=function(){this.sp=this.sp-1&65535};Z80.prototype.instructions[60]=function(){this.a=this.do_inc(this.a)};Z80.prototype.instructions[61]=function(){this.a=this.do_dec(this.a)};Z80.prototype.instructions[62]=function(){this.a=this.core.mem_read(this.pc+1&65535);this.pc=this.pc+1&65535};
Z80.prototype.instructions[63]=function(){this.flags.N=0;this.flags.H=this.flags.C;this.flags.C=this.flags.C?0:1;this.update_xy_flags(this.a)};Z80.prototype.instructions[192]=function(){this.do_conditional_return(!this.flags.Z)};Z80.prototype.instructions[193]=function(){var a=this.pop_word();this.c=a&255;this.b=(a&65280)>>>8};Z80.prototype.instructions[194]=function(){this.do_conditional_absolute_jump(!this.flags.Z)};
Z80.prototype.instructions[195]=function(){this.pc=this.core.mem_read(this.pc+1&65535)|this.core.mem_read(this.pc+2&65535)<<8;this.pc=this.pc-1&65535};Z80.prototype.instructions[196]=function(){this.do_conditional_call(!this.flags.Z)};Z80.prototype.instructions[197]=function(){this.push_word(this.c|this.b<<8)};Z80.prototype.instructions[198]=function(){this.pc=this.pc+1&65535;this.do_add(this.core.mem_read(this.pc))};Z80.prototype.instructions[199]=function(){this.do_reset(0)};
Z80.prototype.instructions[200]=function(){this.do_conditional_return(!!this.flags.Z)};Z80.prototype.instructions[201]=function(){this.pc=this.pop_word()-1&65535};Z80.prototype.instructions[202]=function(){this.do_conditional_absolute_jump(!!this.flags.Z)};
Z80.prototype.instructions[203]=function(){this.r=this.r&128|(this.r&127)+1&127;this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc),b=(a&56)>>>3,c=a&7;if(64>a){var d=[this.do_rlc,this.do_rrc,this.do_rl,this.do_rr,this.do_sla,this.do_sra,this.do_sll,this.do_srl];0===c?this.b=d[b].call(this,this.b):1===c?this.c=d[b].call(this,this.c):2===c?this.d=d[b].call(this,this.d):3===c?this.e=d[b].call(this,this.e):4===c?this.h=d[b].call(this,this.h):5===c?this.l=d[b].call(this,this.l):6===c?this.core.mem_write(this.l|
this.h<<8,d[b].call(this,this.core.mem_read(this.l|this.h<<8))):7===c&&(this.a=d[b].call(this,this.a))}else 128>a?(0===c?this.flags.Z=this.b&1<<b?0:1:1===c?this.flags.Z=this.c&1<<b?0:1:2===c?this.flags.Z=this.d&1<<b?0:1:3===c?this.flags.Z=this.e&1<<b?0:1:4===c?this.flags.Z=this.h&1<<b?0:1:5===c?this.flags.Z=this.l&1<<b?0:1:6===c?this.flags.Z=this.core.mem_read(this.l|this.h<<8)&1<<b?0:1:7===c&&(this.flags.Z=this.a&1<<b?0:1),this.flags.N=0,this.flags.H=1,this.flags.P=this.flags.Z,this.flags.S=7!==
b||this.flags.Z?0:1,this.flags.Y=5!==b||this.flags.Z?0:1,this.flags.X=3!==b||this.flags.Z?0:1):192>a?0===c?this.b&=255&~(1<<b):1===c?this.c&=255&~(1<<b):2===c?this.d&=255&~(1<<b):3===c?this.e&=255&~(1<<b):4===c?this.h&=255&~(1<<b):5===c?this.l&=255&~(1<<b):6===c?this.core.mem_write(this.l|this.h<<8,this.core.mem_read(this.l|this.h<<8)&~(1<<b)):7===c&&(this.a&=255&~(1<<b)):0===c?this.b|=1<<b:1===c?this.c|=1<<b:2===c?this.d|=1<<b:3===c?this.e|=1<<b:4===c?this.h|=1<<b:5===c?this.l|=1<<b:6===c?this.core.mem_write(this.l|
this.h<<8,this.core.mem_read(this.l|this.h<<8)|1<<b):7===c&&(this.a|=1<<b);this.cycle_counter+=this.cycle_counts_cb[a]};Z80.prototype.instructions[204]=function(){this.do_conditional_call(!!this.flags.Z)};Z80.prototype.instructions[205]=function(){this.push_word(this.pc+3&65535);this.pc=this.core.mem_read(this.pc+1&65535)|this.core.mem_read(this.pc+2&65535)<<8;this.pc=this.pc-1&65535};Z80.prototype.instructions[206]=function(){this.pc=this.pc+1&65535;this.do_adc(this.core.mem_read(this.pc))};
Z80.prototype.instructions[207]=function(){this.do_reset(8)};Z80.prototype.instructions[208]=function(){this.do_conditional_return(!this.flags.C)};Z80.prototype.instructions[209]=function(){var a=this.pop_word();this.e=a&255;this.d=(a&65280)>>>8};Z80.prototype.instructions[210]=function(){this.do_conditional_absolute_jump(!this.flags.C)};Z80.prototype.instructions[211]=function(){this.pc=this.pc+1&65535;this.core.io_write(this.a<<8|this.core.mem_read(this.pc),this.a)};
Z80.prototype.instructions[212]=function(){this.do_conditional_call(!this.flags.C)};Z80.prototype.instructions[213]=function(){this.push_word(this.e|this.d<<8)};Z80.prototype.instructions[214]=function(){this.pc=this.pc+1&65535;this.do_sub(this.core.mem_read(this.pc))};Z80.prototype.instructions[215]=function(){this.do_reset(16)};Z80.prototype.instructions[216]=function(){this.do_conditional_return(!!this.flags.C)};
Z80.prototype.instructions[217]=function(){var a=this.b;this.b=this.b_prime;this.b_prime=a;a=this.c;this.c=this.c_prime;this.c_prime=a;a=this.d;this.d=this.d_prime;this.d_prime=a;a=this.e;this.e=this.e_prime;this.e_prime=a;a=this.h;this.h=this.h_prime;this.h_prime=a;a=this.l;this.l=this.l_prime;this.l_prime=a};Z80.prototype.instructions[218]=function(){this.do_conditional_absolute_jump(!!this.flags.C)};
Z80.prototype.instructions[219]=function(){this.pc=this.pc+1&65535;this.a=this.core.io_read(this.a<<8|this.core.mem_read(this.pc))};Z80.prototype.instructions[220]=function(){this.do_conditional_call(!!this.flags.C)};Z80.prototype.instructions[221]=function(){this.r=this.r&128|(this.r&127)+1&127;this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc),b=this.dd_instructions[a];b?(b=b.bind(this),b(),this.cycle_counter+=this.cycle_counts_dd[a]):(this.pc=this.pc-1&65535,this.cycle_counter+=this.cycle_counts[0])};
Z80.prototype.instructions[222]=function(){this.pc=this.pc+1&65535;this.do_sbc(this.core.mem_read(this.pc))};Z80.prototype.instructions[223]=function(){this.do_reset(24)};Z80.prototype.instructions[224]=function(){this.do_conditional_return(!this.flags.P)};Z80.prototype.instructions[225]=function(){var a=this.pop_word();this.l=a&255;this.h=(a&65280)>>>8};Z80.prototype.instructions[226]=function(){this.do_conditional_absolute_jump(!this.flags.P)};
Z80.prototype.instructions[227]=function(){var a=this.core.mem_read(this.sp);this.core.mem_write(this.sp,this.l);this.l=a;a=this.core.mem_read(this.sp+1&65535);this.core.mem_write(this.sp+1&65535,this.h);this.h=a};Z80.prototype.instructions[228]=function(){this.do_conditional_call(!this.flags.P)};Z80.prototype.instructions[229]=function(){this.push_word(this.l|this.h<<8)};Z80.prototype.instructions[230]=function(){this.pc=this.pc+1&65535;this.do_and(this.core.mem_read(this.pc))};
Z80.prototype.instructions[231]=function(){this.do_reset(32)};Z80.prototype.instructions[232]=function(){this.do_conditional_return(!!this.flags.P)};Z80.prototype.instructions[233]=function(){this.pc=this.l|this.h<<8;this.pc=this.pc-1&65535};Z80.prototype.instructions[234]=function(){this.do_conditional_absolute_jump(!!this.flags.P)};Z80.prototype.instructions[235]=function(){var a=this.d;this.d=this.h;this.h=a;a=this.e;this.e=this.l;this.l=a};Z80.prototype.instructions[236]=function(){this.do_conditional_call(!!this.flags.P)};
Z80.prototype.instructions[237]=function(){this.r=this.r&128|(this.r&127)+1&127;this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc),b=this.ed_instructions[a];b?(b=b.bind(this),b(),this.cycle_counter+=this.cycle_counts_ed[a]):this.cycle_counter+=this.cycle_counts[0]};Z80.prototype.instructions[238]=function(){this.pc=this.pc+1&65535;this.do_xor(this.core.mem_read(this.pc))};Z80.prototype.instructions[239]=function(){this.do_reset(40)};Z80.prototype.instructions[240]=function(){this.do_conditional_return(!this.flags.S)};
Z80.prototype.instructions[241]=function(){var a=this.pop_word();this.set_flags_register(a&255);this.a=(a&65280)>>>8};Z80.prototype.instructions[242]=function(){this.do_conditional_absolute_jump(!this.flags.S)};Z80.prototype.instructions[243]=function(){this.do_delayed_di=!0};Z80.prototype.instructions[244]=function(){this.do_conditional_call(!this.flags.S)};Z80.prototype.instructions[245]=function(){this.push_word(this.get_flags_register()|this.a<<8)};
Z80.prototype.instructions[246]=function(){this.pc=this.pc+1&65535;this.do_or(this.core.mem_read(this.pc))};Z80.prototype.instructions[247]=function(){this.do_reset(48)};Z80.prototype.instructions[248]=function(){this.do_conditional_return(!!this.flags.S)};Z80.prototype.instructions[249]=function(){this.sp=this.l|this.h<<8};Z80.prototype.instructions[250]=function(){this.do_conditional_absolute_jump(!!this.flags.S)};Z80.prototype.instructions[251]=function(){this.do_delayed_ei=!0};
Z80.prototype.instructions[252]=function(){this.do_conditional_call(!!this.flags.S)};Z80.prototype.instructions[253]=function(){this.r=this.r&128|(this.r&127)+1&127;this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc),b=this.dd_instructions[a];if(b){var c=this.ix;this.ix=this.iy;b=b.bind(this);b();this.iy=this.ix;this.ix=c;this.cycle_counter+=this.cycle_counts_dd[a]}else this.pc=this.pc-1&65535,this.cycle_counter+=this.cycle_counts[0]};
Z80.prototype.instructions[254]=function(){this.pc=this.pc+1&65535;this.do_cp(this.core.mem_read(this.pc))};Z80.prototype.instructions[255]=function(){this.do_reset(56)};Z80.prototype.ed_instructions=[];Z80.prototype.ed_instructions[64]=function(){this.b=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[65]=function(){this.core.io_write(this.b<<8|this.c,this.b)};Z80.prototype.ed_instructions[66]=function(){this.do_hl_sbc(this.c|this.b<<8)};
Z80.prototype.ed_instructions[67]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.c);this.core.mem_write(a+1&65535,this.b)};Z80.prototype.ed_instructions[68]=function(){this.do_neg()};Z80.prototype.ed_instructions[69]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[70]=function(){this.imode=0};Z80.prototype.ed_instructions[71]=function(){this.i=this.a};
Z80.prototype.ed_instructions[72]=function(){this.c=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[73]=function(){this.core.io_write(this.b<<8|this.c,this.c)};Z80.prototype.ed_instructions[74]=function(){this.do_hl_adc(this.c|this.b<<8)};Z80.prototype.ed_instructions[75]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.c=this.core.mem_read(a);this.b=this.core.mem_read(a+1&65535)};
Z80.prototype.ed_instructions[76]=function(){this.do_neg()};Z80.prototype.ed_instructions[77]=function(){this.pc=this.pop_word()-1&65535};Z80.prototype.ed_instructions[78]=function(){this.imode=0};Z80.prototype.ed_instructions[79]=function(){this.r=this.a};Z80.prototype.ed_instructions[80]=function(){this.d=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[81]=function(){this.core.io_write(this.b<<8|this.c,this.d)};
Z80.prototype.ed_instructions[82]=function(){this.do_hl_sbc(this.e|this.d<<8)};Z80.prototype.ed_instructions[83]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.e);this.core.mem_write(a+1&65535,this.d)};Z80.prototype.ed_instructions[84]=function(){this.do_neg()};Z80.prototype.ed_instructions[85]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};
Z80.prototype.ed_instructions[86]=function(){this.imode=1};Z80.prototype.ed_instructions[87]=function(){this.a=this.i;this.flags.P=this.iff2};Z80.prototype.ed_instructions[88]=function(){this.e=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[89]=function(){this.core.io_write(this.b<<8|this.c,this.e)};Z80.prototype.ed_instructions[90]=function(){this.do_hl_adc(this.e|this.d<<8)};
Z80.prototype.ed_instructions[91]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.e=this.core.mem_read(a);this.d=this.core.mem_read(a+1&65535)};Z80.prototype.ed_instructions[92]=function(){this.do_neg()};Z80.prototype.ed_instructions[93]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[94]=function(){this.imode=2};
Z80.prototype.ed_instructions[95]=function(){this.a=this.r;this.flags.P=this.iff2};Z80.prototype.ed_instructions[96]=function(){this.h=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[97]=function(){this.core.io_write(this.b<<8|this.c,this.h)};Z80.prototype.ed_instructions[98]=function(){this.do_hl_sbc(this.l|this.h<<8)};
Z80.prototype.ed_instructions[99]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.l);this.core.mem_write(a+1&65535,this.h)};Z80.prototype.ed_instructions[100]=function(){this.do_neg()};Z80.prototype.ed_instructions[101]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[102]=function(){this.imode=0};
Z80.prototype.ed_instructions[103]=function(){var a=this.core.mem_read(this.l|this.h<<8),b=a&15,a=(a&240)>>>4|(this.a&15)<<4;this.a=this.a&240|b;this.core.mem_write(this.l|this.h<<8,a);this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=0;this.flags.P=this.get_parity(this.a)?1:0;this.flags.N=0;this.update_xy_flags(this.a)};Z80.prototype.ed_instructions[104]=function(){this.l=this.do_in(this.b<<8|this.c)};
Z80.prototype.ed_instructions[105]=function(){this.core.io_write(this.b<<8|this.c,this.l)};Z80.prototype.ed_instructions[106]=function(){this.do_hl_adc(this.l|this.h<<8)};Z80.prototype.ed_instructions[107]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.l=this.core.mem_read(a);this.h=this.core.mem_read(a+1&65535)};Z80.prototype.ed_instructions[108]=function(){this.do_neg()};
Z80.prototype.ed_instructions[109]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[110]=function(){this.imode=0};Z80.prototype.ed_instructions[111]=function(){var a=this.core.mem_read(this.l|this.h<<8),b=a&240,a=(a&15)<<4|this.a&15;this.a=this.a&240|b>>>4;this.core.mem_write(this.l|this.h<<8,a);this.flags.S=this.a&128?1:0;this.flags.Z=this.a?0:1;this.flags.H=0;this.flags.P=this.get_parity(this.a)?1:0;this.flags.N=0;this.update_xy_flags(this.a)};
Z80.prototype.ed_instructions[112]=function(){this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[113]=function(){this.core.io_write(this.b<<8|this.c,0)};Z80.prototype.ed_instructions[114]=function(){this.do_hl_sbc(this.sp)};Z80.prototype.ed_instructions[115]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.sp&255);this.core.mem_write(a+1&65535,this.sp>>>8&255)};
Z80.prototype.ed_instructions[116]=function(){this.do_neg()};Z80.prototype.ed_instructions[117]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[118]=function(){this.imode=1};Z80.prototype.ed_instructions[120]=function(){this.a=this.do_in(this.b<<8|this.c)};Z80.prototype.ed_instructions[121]=function(){this.core.io_write(this.b<<8|this.c,this.a)};Z80.prototype.ed_instructions[122]=function(){this.do_hl_adc(this.sp)};
Z80.prototype.ed_instructions[123]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.sp=this.core.mem_read(a);this.sp|=this.core.mem_read(a+1&65535)<<8};Z80.prototype.ed_instructions[124]=function(){this.do_neg()};Z80.prototype.ed_instructions[125]=function(){this.pc=this.pop_word()-1&65535;this.iff1=this.iff2};Z80.prototype.ed_instructions[126]=function(){this.imode=2};Z80.prototype.ed_instructions[160]=function(){this.do_ldi()};
Z80.prototype.ed_instructions[161]=function(){this.do_cpi()};Z80.prototype.ed_instructions[162]=function(){this.do_ini()};Z80.prototype.ed_instructions[163]=function(){this.do_outi()};Z80.prototype.ed_instructions[168]=function(){this.do_ldd()};Z80.prototype.ed_instructions[169]=function(){this.do_cpd()};Z80.prototype.ed_instructions[170]=function(){this.do_ind()};Z80.prototype.ed_instructions[171]=function(){this.do_outd()};
Z80.prototype.ed_instructions[176]=function(){this.do_ldi();if(this.b||this.c)this.cycle_counter+=5,this.pc=this.pc-2&65535};Z80.prototype.ed_instructions[177]=function(){this.do_cpi();this.flags.Z||!this.b&&!this.c||(this.cycle_counter+=5,this.pc=this.pc-2&65535)};Z80.prototype.ed_instructions[178]=function(){this.do_ini();this.b&&(this.cycle_counter+=5,this.pc=this.pc-2&65535)};Z80.prototype.ed_instructions[179]=function(){this.do_outi();this.b&&(this.cycle_counter+=5,this.pc=this.pc-2&65535)};
Z80.prototype.ed_instructions[184]=function(){this.do_ldd();if(this.b||this.c)this.cycle_counter+=5,this.pc=this.pc-2&65535};Z80.prototype.ed_instructions[185]=function(){this.do_cpd();this.flags.Z||!this.b&&!this.c||(this.cycle_counter+=5,this.pc=this.pc-2&65535)};Z80.prototype.ed_instructions[186]=function(){this.do_ind();this.b&&(this.cycle_counter+=5,this.pc=this.pc-2&65535)};Z80.prototype.ed_instructions[187]=function(){this.do_outd();this.b&&(this.cycle_counter+=5,this.pc=this.pc-2&65535)};
Z80.prototype.dd_instructions=[];Z80.prototype.dd_instructions[9]=function(){this.do_ix_add(this.c|this.b<<8)};Z80.prototype.dd_instructions[25]=function(){this.do_ix_add(this.e|this.d<<8)};Z80.prototype.dd_instructions[33]=function(){this.pc=this.pc+1&65535;this.ix=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;this.ix|=this.core.mem_read(this.pc)<<8};
Z80.prototype.dd_instructions[34]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.core.mem_write(a,this.ix&255);this.core.mem_write(a+1&65535,this.ix>>>8&255)};Z80.prototype.dd_instructions[35]=function(){this.ix=this.ix+1&65535};Z80.prototype.dd_instructions[36]=function(){this.ix=this.do_inc(this.ix>>>8)<<8|this.ix&255};Z80.prototype.dd_instructions[37]=function(){this.ix=this.do_dec(this.ix>>>8)<<8|this.ix&255};
Z80.prototype.dd_instructions[38]=function(){this.pc=this.pc+1&65535;this.ix=this.core.mem_read(this.pc)<<8|this.ix&255};Z80.prototype.dd_instructions[41]=function(){this.do_ix_add(this.ix)};Z80.prototype.dd_instructions[42]=function(){this.pc=this.pc+1&65535;var a=this.core.mem_read(this.pc);this.pc=this.pc+1&65535;a|=this.core.mem_read(this.pc)<<8;this.ix=this.core.mem_read(a);this.ix|=this.core.mem_read(a+1&65535)<<8};Z80.prototype.dd_instructions[43]=function(){this.ix=this.ix-1&65535};
Z80.prototype.dd_instructions[44]=function(){this.ix=this.do_inc(this.ix&255)|this.ix&65280};Z80.prototype.dd_instructions[45]=function(){this.ix=this.do_dec(this.ix&255)|this.ix&65280};Z80.prototype.dd_instructions[46]=function(){this.pc=this.pc+1&65535;this.ix=this.core.mem_read(this.pc)&255|this.ix&65280};
Z80.prototype.dd_instructions[52]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc)),b=this.core.mem_read(a+this.ix&65535);this.core.mem_write(a+this.ix&65535,this.do_inc(b))};Z80.prototype.dd_instructions[53]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc)),b=this.core.mem_read(a+this.ix&65535);this.core.mem_write(a+this.ix&65535,this.do_dec(b))};
Z80.prototype.dd_instructions[54]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.pc=this.pc+1&65535;this.core.mem_write(this.ix+a&65535,this.core.mem_read(this.pc))};Z80.prototype.dd_instructions[57]=function(){this.do_ix_add(this.sp)};Z80.prototype.dd_instructions[68]=function(){this.b=this.ix>>>8&255};Z80.prototype.dd_instructions[69]=function(){this.b=this.ix&255};
Z80.prototype.dd_instructions[70]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.b=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[76]=function(){this.c=this.ix>>>8&255};Z80.prototype.dd_instructions[77]=function(){this.c=this.ix&255};Z80.prototype.dd_instructions[78]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.c=this.core.mem_read(this.ix+a&65535)};
Z80.prototype.dd_instructions[84]=function(){this.d=this.ix>>>8&255};Z80.prototype.dd_instructions[85]=function(){this.d=this.ix&255};Z80.prototype.dd_instructions[86]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.d=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[92]=function(){this.e=this.ix>>>8&255};Z80.prototype.dd_instructions[93]=function(){this.e=this.ix&255};
Z80.prototype.dd_instructions[94]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.e=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[96]=function(){this.ix=this.ix&255|this.b<<8};Z80.prototype.dd_instructions[97]=function(){this.ix=this.ix&255|this.c<<8};Z80.prototype.dd_instructions[98]=function(){this.ix=this.ix&255|this.d<<8};Z80.prototype.dd_instructions[99]=function(){this.ix=this.ix&255|this.e<<8};
Z80.prototype.dd_instructions[100]=function(){};Z80.prototype.dd_instructions[101]=function(){this.ix=this.ix&255|(this.ix&255)<<8};Z80.prototype.dd_instructions[102]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.h=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[103]=function(){this.ix=this.ix&255|this.a<<8};Z80.prototype.dd_instructions[104]=function(){this.ix=this.ix&65280|this.b};
Z80.prototype.dd_instructions[105]=function(){this.ix=this.ix&65280|this.c};Z80.prototype.dd_instructions[106]=function(){this.ix=this.ix&65280|this.d};Z80.prototype.dd_instructions[107]=function(){this.ix=this.ix&65280|this.e};Z80.prototype.dd_instructions[108]=function(){this.ix=this.ix&65280|this.ix>>>8};Z80.prototype.dd_instructions[109]=function(){};
Z80.prototype.dd_instructions[110]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.l=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[111]=function(){this.ix=this.ix&65280|this.a};Z80.prototype.dd_instructions[112]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.b)};
Z80.prototype.dd_instructions[113]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.c)};Z80.prototype.dd_instructions[114]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.d)};
Z80.prototype.dd_instructions[115]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.e)};Z80.prototype.dd_instructions[116]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.h)};
Z80.prototype.dd_instructions[117]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.l)};Z80.prototype.dd_instructions[119]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.core.mem_write(this.ix+a&65535,this.a)};Z80.prototype.dd_instructions[124]=function(){this.a=this.ix>>>8&255};Z80.prototype.dd_instructions[125]=function(){this.a=this.ix&255};
Z80.prototype.dd_instructions[126]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.a=this.core.mem_read(this.ix+a&65535)};Z80.prototype.dd_instructions[132]=function(){this.do_add(this.ix>>>8&255)};Z80.prototype.dd_instructions[133]=function(){this.do_add(this.ix&255)};Z80.prototype.dd_instructions[134]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_add(this.core.mem_read(this.ix+a&65535))};
Z80.prototype.dd_instructions[140]=function(){this.do_adc(this.ix>>>8&255)};Z80.prototype.dd_instructions[141]=function(){this.do_adc(this.ix&255)};Z80.prototype.dd_instructions[142]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_adc(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[148]=function(){this.do_sub(this.ix>>>8&255)};Z80.prototype.dd_instructions[149]=function(){this.do_sub(this.ix&255)};
Z80.prototype.dd_instructions[150]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_sub(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[156]=function(){this.do_sbc(this.ix>>>8&255)};Z80.prototype.dd_instructions[157]=function(){this.do_sbc(this.ix&255)};
Z80.prototype.dd_instructions[158]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_sbc(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[164]=function(){this.do_and(this.ix>>>8&255)};Z80.prototype.dd_instructions[165]=function(){this.do_and(this.ix&255)};
Z80.prototype.dd_instructions[166]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_and(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[172]=function(){this.do_xor(this.ix>>>8&255)};Z80.prototype.dd_instructions[173]=function(){this.do_xor(this.ix&255)};
Z80.prototype.dd_instructions[174]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_xor(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[180]=function(){this.do_or(this.ix>>>8&255)};Z80.prototype.dd_instructions[181]=function(){this.do_or(this.ix&255)};
Z80.prototype.dd_instructions[182]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_or(this.core.mem_read(this.ix+a&65535))};Z80.prototype.dd_instructions[188]=function(){this.do_cp(this.ix>>>8&255)};Z80.prototype.dd_instructions[189]=function(){this.do_cp(this.ix&255)};
Z80.prototype.dd_instructions[190]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.do_cp(this.core.mem_read(this.ix+a&65535))};
Z80.prototype.dd_instructions[203]=function(){this.pc=this.pc+1&65535;var a=this.get_signed_offset_byte(this.core.mem_read(this.pc));this.pc=this.pc+1&65535;var b=this.core.mem_read(this.pc),c;if(64>b)c=[this.do_rlc,this.do_rrc,this.do_rl,this.do_rr,this.do_sla,this.do_sra,this.do_sll,this.do_srl][(b&56)>>>3].call(this,this.core.mem_read(this.ix+a&65535)),this.core.mem_write(this.ix+a&65535,c);else{var d=(b&56)>>>3;128>b?(this.flags.N=0,this.flags.H=1,this.flags.Z=this.core.mem_read(this.ix+a&65535)&
1<<d?0:1,this.flags.P=this.flags.Z,this.flags.S=7!==d||this.flags.Z?0:1):(c=192>b?this.core.mem_read(this.ix+a&65535)&~(1<<d)&255:this.core.mem_read(this.ix+a&65535)|1<<d,this.core.mem_write(this.ix+a&65535,c))}void 0!==c&&(0===(b&7)?this.b=c:1===(b&7)?this.c=c:2===(b&7)?this.d=c:3===(b&7)?this.e=c:4===(b&7)?this.h=c:5===(b&7)?this.l=c:7===(b&7)&&(this.a=c));this.cycle_counter+=this.cycle_counts_cb[b]+8};Z80.prototype.dd_instructions[225]=function(){this.ix=this.pop_word()};
Z80.prototype.dd_instructions[227]=function(){var a=this.ix;this.ix=this.core.mem_read(this.sp);this.ix|=this.core.mem_read(this.sp+1&65535)<<8;this.core.mem_write(this.sp,a&255);this.core.mem_write(this.sp+1&65535,a>>>8&255)};Z80.prototype.dd_instructions[229]=function(){this.push_word(this.ix)};Z80.prototype.dd_instructions[233]=function(){this.pc=this.ix-1&65535};Z80.prototype.dd_instructions[249]=function(){this.sp=this.ix};
Z80.prototype.cycle_counts=[4,10,7,6,4,4,7,4,4,11,7,6,4,4,7,4,8,10,7,6,4,4,7,4,12,11,7,6,4,4,7,4,7,10,16,6,4,4,7,4,7,11,16,6,4,4,7,4,7,10,13,6,11,11,10,4,7,11,13,6,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,7,7,7,7,7,7,4,7,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,4,4,4,4,4,4,7,4,5,10,10,10,10,11,7,11,5,10,10,0,10,17,7,11,5,10,10,11,10,11,7,11,5,4,10,11,
10,0,7,11,5,10,10,19,10,11,7,11,5,4,10,4,10,0,7,11,5,10,10,4,10,11,7,11,5,4,10,4,10,0,7,11];
Z80.prototype.cycle_counts_ed=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,9,12,12,15,20,8,14,8,18,12,12,15,20,8,14,8,18,12,12,15,20,8,14,8,0,12,12,15,20,8,14,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,16,16,16,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
Z80.prototype.cycle_counts_cb=[8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,12,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,
15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8,8,8,8,8,8,8,15,8];
Z80.prototype.cycle_counts_dd=[0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0,14,20,10,8,8,11,0,0,15,20,10,8,8,11,0,0,0,0,0,23,23,19,0,0,15,0,0,0,0,0,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,8,8,8,8,8,8,19,8,8,8,8,8,8,8,19,8,19,19,19,19,19,19,0,19,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,8,8,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,14,0,23,0,15,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0];
